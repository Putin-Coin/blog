<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<link rel="subresource" src="//use.typekit.net/ayq0lpd.js"/>
<link rel="subresource" src="//www.google-analytics.com/analytics.js"/>

<title>How to Unit Test Private Functions in JavaScript &mdash; Philip Walton</title>

<!--[if lt IE 9]><script src="/assets/javascript/html5shiv.js"></script><![endif]-->

<!-- Put typekit in the head for the fastest possible download. -->
<script src="//use.typekit.net/ayq0lpd.js"></script>

<script>
ga = function() { ga.q.push(arguments); };
ga.q = []; ga.l = 1 * new Date();

// Create the GA tracker before doing any logging.
ga('create', 'UA-21292978-1', 'auto');



  // In non-production mode, simply log GA hits to the console.
  ga(function(tracker) {
    tracker.set('sendHitTask', function() {
      // Throw to stop subsequent tasks.
      throw 'Abort tracking in non-production environments.'
    });
  });



// Initialize typekit and track how frequently it fails.
try {
  Typekit.load();
}
catch(err) {
  ga('send', 'exception', {
    exDescription: err.stack || err.message,
    exFatal: false
  });
}


// Track uncaught errors via Google Analytics.
window.onerror = function(message, url, line, col) {
  var desc = message + ' (line: ' + line + ', url: ' + url + ', col: '
      + col + ')';
  ga('send', 'exception', {
    exDescription: 'window.onerror: ' + desc,
    exFatal: false
  });
};


// Note, tasks must be set before sending the first hit
ga('send', 'pageview');
</script>


<link href="/assets/css/style.css" rel="stylesheet">
<link href="http://feeds.feedburner.com/philipwalton" rel="alternate" title="Philip Walton" type="application/atom+xml">

<meta name="description" content="JavaScript&#x27;s closures provide an excellent way to make variables and functions private, keeping them out of the global scope">
<meta name="viewport" content="width=device-width, initial-scale=1">

<svg display="none">
  <defs>
    <path id="icon-twitter-bird" d="M34.7 5c1.7-1 2.8-2.5 3.4-4.4-1.6 0.9-3.3 1.6-5 2-1.6-1.7-3.6-2.6-5.8-2.6-2.2 0-4.2 0.7-5.7 2.3-1.6 1.6-2.3 3.4-2.3 5.8 0 0.6 0.1 1.2 0.2 1.8-6.9-0.4-12.6-3.2-16.9-8.5-0.7 1.2-1.1 2.7-1.1 4.1 0 3 1.2 5.2 3.6 6.8-1.2 0-2.5-0.4-3.6-1v0.1c0 2 0.6 3.7 1.8 5.2 1.2 1.5 2.7 2.5 4.6 2.8-0.6 0.1-1.2 0.2-2.1 0.2-0.4 0-0.9 0-1.5-0.1 0.5 1.5 1.4 2.8 2.8 3.8 1.4 1 3 1.5 4.7 1.6-3.1 2.5-6.4 3.7-10 3.7-0.5 0-1.1 0-2-0.1 3.7 2.2 7.8 3.4 12.4 3.4 3.6 0 6.8-0.7 9.8-2.1 3-1.4 5.4-3.2 7.3-5.4 1.8-2.2 3.3-4.7 4.3-7.4s1.6-5.4 1.6-8.1v-1c1.4-1 2.7-2.5 3.9-4.2-1.6 0.6-3.2 1.1-4.7 1.2z"></path>
    <path id="icon-rss" d="M16 0q6.6 0 11.3 4.7t4.7 11.3q0 6.6-4.7 11.3t-11.3 4.7-11.3-4.7-4.7-11.3 4.7-11.3 11.3-4.7zM10.7 24q1.1 0 1.9-0.8t0.8-1.9-0.8-1.9-1.9-0.8-1.9 0.8-0.8 1.9 0.8 1.9 1.9 0.8zM16.7 24h3.3q0-5-3.5-8.5t-8.5-3.5v3.3q3.6 0 6.1 2.5t2.5 6.1zM22.7 24h3.3q0-3.7-1.4-7t-3.8-5.7-5.7-3.8-7-1.4v3.3q6.1 0 10.4 4.3t4.3 10.4z"></path>
    <path id="icon-twitter" d="M16 0q6.6 0 11.3 4.7t4.7 11.3-4.7 11.3-11.3 4.7-11.3-4.7-4.7-11.3 4.7-11.3 11.3-4.7zM25.7 12.5q1.2-0.9 2.3-2.3-1.3 0.6-2.6 0.7 1.4-0.8 2-2.5-1.4 0.8-2.9 1.1-1.3-1.4-3.3-1.4-1.9 0-3.2 1.3t-1.3 3.2q0 0.6 0.1 1-5.7-0.3-9.4-4.8-0.6 1.1-0.6 2.3 0 2.4 2 3.8-1 0-2-0.6v0q0 1.6 1 2.9t2.6 1.6q-0.5 0.1-1.2 0.1-0.3 0-0.9-0.1 0.4 1.4 1.6 2.2t2.6 0.9q-2.6 2.1-5.6 2.1-0.4 0-1.1-0.1 3.1 2 7 2 3 0 5.5-1.2t4.1-3.1 2.4-4.1 0.9-4.6v-0.6z"></path>
    <path id="icon-github" d="M16 0q6.59 0 11.3 4.7t4.7 11.3q0 5.52-3.39 9.85t-8.61 5.67v-4.18q0-2.89-1.67-4.18 3.37-0.52 5.52-2.41t2.15-4.74q0-2.52-1.85-4.59 0.67-3.07-0.15-4.74-2.04 0.19-4.63 1.78-1.78-0.44-3.37-0.44t-3.37 0.44q-2.59-1.59-4.63-1.78-0.85 1.78-0.15 4.74-1.85 2.07-1.85 4.59 0 2.85 2.15 4.74t5.52 2.41q-0.85 0.63-1.3 1.82-0.67 0-1.37-0.13t-1.28-0.35-1.11-0.5-0.96-0.56-0.72-0.52-0.48-0.39l-0.15-0.15q-0.26-0.26-0.52-0.07-0.3 0.19-0.22 0.52 0.7 1.37 1.19 2 1.93 2.48 5.26 3.48v3.22q-5.22-1.33-8.61-5.67t-3.39-9.85q0-6.63 4.68-11.31t11.32-4.68z"></path>
  </defs>
</svg>


  </head>
  <body class="Site">

    <div class="Site-header">
      <header class="Header">
        <a class="Header-info" href="/" title="Home">
          <h1 class="Header-title">Philip Walton</h1>
          <p class="Header-tagline">Engineer at Google</p>
        </a>
        <a class="Header-photo" href="/" title="Home"></a>
        <div class="Header-social">
          <nav class="SocialNav">
  <a class="SocialNav-icon SocialNav-icon--twitter"
     href="https://twitter.com/philwalton"
     title="Twitter">
    <svg viewBox="0 0 32 32">
      <use xlink:href="#icon-twitter"></use>
    </svg>
  </a>
  <a class="SocialNav-icon SocialNav-icon--github"
     href="https://github.com/philipwalton"
     title="Github">
    <svg viewBox="0 0 32 32">
      <use xlink:href="#icon-github"></use>
    </svg>
  </a>
  <a class="SocialNav-icon SocialNav-icon--rss"
     href="http://feeds.feedburner.com/philipwalton"
     title="RSS">
    <svg viewBox="0 0 32 32">
      <use xlink:href="#icon-rss"></use>
    </svg>
  </a>
</nav>
        </div>
        <div class="Header-nav">
          <nav class="MainNav">
  <a href="/" title="Home">Home</a>
  <a href="/articles/" title="Articles">Articles</a>
  <a href="/about/" title="About">About</a>
</nav>
        </div>
      </header>
    </div>

    <div class="Site-contentContainer">
      <main class="Site-content">
        
<article role="article" class="hentry">

  <header class="ContentHeader">
    <h1 class="ContentHeader-title entry-title">How to Unit Test Private Functions in JavaScript</h1>
    <time class="ContentHeader-date published"
        datetime="2013-07-08T23:28:18-07:00">
      July 8, 2013
    </time>
  </header>

  <div class="entry-content">
    <div class="Callout">
  <p><strong>Update:</strong> A lot of readers have commented or tweeted that I shouldn’t be unit testing private functions in the first place. Admittedly, this article is a little light on the <em>why</em> and mainly focuses on the <em>how</em>.</p>

  <p>To explain some of my rationale, I wrote a follow-up article: <a href="/articles/why-i-test-private-functions-in-javascript/">Why I Test Private Functions In JavaScript</a></p>
</div>

<p>JavaScript’s closures provide an excellent way to make variables and functions private, keeping them out of the global scope. This is particularly important in the browser because all scripts share the same scope, and it’s quite easy to inadvertently pick a variable or function name used by another library.</p>
<p>The problem, however, is that when functions are hidden inside a closure, it’s very difficult to test them.</p>
<p>Here’s an example:</p>
<pre class="highlight"><code class="javascript"><span class="keyword">var</span> myModule = (<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>

  <span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> {</span>
    <span class="comment">// private function `foo` inside closure</span>
    <span class="keyword">return</span> <span class="string">"foo"</span>
  }

  <span class="keyword">return</span> {
    bar: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
      <span class="comment">// public function `bar` returned from closure</span>
      <span class="keyword">return</span> <span class="string">"bar"</span>
    }
  }
}())</code></pre><p>The immediately invoked function expression returns an object that exposes the <code>bar</code> function globally, but the <code>foo</code> function remains inaccessible to any code not appearing inside the immediately invoked function.</p>
<p>In other words, given the above code, writing a unit test for <code>bar</code> is easy, but writing a unit test for <code>foo</code> is impossible. So what can you do? How can you test <code>foo</code>?</p>
<p>If you search Stack Overflow for a solution to this problem, you’ll basically find the following two suggestions repeated over and over again:</p>
<ol>
<li>Don’t test private functions (since they’re implementation details)</li>
<li>If you must test them, make them public</li>
</ol>
<p>Personally, I don’t agree with these statements.</p>
<p>While they may apply to some contexts, they certainly don’t make sense for every project. And from my own experience writing JavaScript, I’ve encountered numerous situations where I needed to test a function but still wanted it hidden from the public API.</p>
<p>I believe any real solution to this problem shouldn’t require developers to compromise their design patterns for the sake of testing, nor should it require lesser test coverage just to produce a nicer API. We should be able to have it both ways.</p>
<p>Below is the solution I use that I think handles these issues quite nicely.</p>
<h2 id="my-solution">My Solution</h2>
<p>Given the nature of JavaScript scoping, we know it’s impossible to access local variables from outside of a function closure without a reference to those variables. So any possible solution must do one of two things:</p>
<ol>
<li>Put the test code itself inside the closure</li>
<li>Add code inside the closure that stores references to the local variables on existing objects in the outer scope.</li>
</ol>
<p>Option one is not really a good solution because you usually want to keep all your test code together in the same place. Mixing your tests with the production code would make it significantly harder to maintain and organize.</p>
<p>On the other hand, option two kinda defeats the purpose of encapsulating the code in the first place.</p>
<p>But what if there were a way to use option two conditionally? What if we could write code inside a closure that gives our test code access to the private functions we care about, but then remove that code when we deploy to production?</p>
<p>If you’re using a build system, you can do exactly that.</p>
<h3 id="different-builds-for-testing-and-production">Different Builds for Testing and Production</h3>
<p>Consider the above myModule example with the following code additions (changes highlighted):</p>
<pre class="highlight"><code class="javascript"><span class="keyword">var</span> myModule = (<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>

  <span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> {</span>
    <span class="comment">// private function `foo` inside closure</span>
    <span class="keyword">return</span> <span class="string">"foo"</span>
  }

  <span class="keyword">var</span> api = {
    bar: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
      <span class="comment">// public function `bar` returned from closure</span>
      <span class="keyword">return</span> <span class="string">"bar"</span>
    }
  }

  <em><span class="comment">/* test-code */</span></em>
  <em>api._foo = foo</em>
  <em><span class="comment">/* end-test-code */</span></em>

  <span class="keyword">return</span> api
}())</code></pre><p>As you can see, the above changes expose the <code>foo</code> function on the module, but do so in a way that can be easily identified by the surrounding comments and stripped out later.</p>
<p>The strategy here is to write your code exactly how you’d like it to appear when released, then add on whatever bridge code you need to expose the parts you want to test.</p>
<h3 id="an-example-implementation">An Example Implementation</h3>
<p>Assuming you’re already using a build system (if you’re not I highly recommend doing so), adding an extra step to strip out test-only code blocks is relatively easy. Below is an example of how you could implement this using <a href="http://gruntjs.com/">GruntJS</a> and the <a href="https://github.com/philipwalton/grunt-strip-code">grunt-strip-code</a> plugin.</p>
<p>First, make sure to add the task as a dependency to your project:</p>
<pre class="highlight"><code class="bash">npm install grunt-strip-code --save-dev</code></pre><p>Then enable it inside your Gruntfile:</p>
<pre class="highlight"><code class="javascript">grunt.loadNpmTasks(<span class="string">'grunt-strip-code'</span>);</code></pre><p>Next, add your project specific data to the <code>initConfig</code> object:</p>
<pre class="highlight"><code class="javascript">grunt.initConfig({
  strip_code: {
    options: {
      start_comment: <span class="string">"test-code"</span>,
      end_comment: <span class="string">"end-test-code"</span>,
    },
    your_target: {
      <span class="comment">// a list of files you want to strip code from</span>
      src: <span class="string">"dist/*.js"</span>
    }
  }
})</code></pre><p>Finally, add your new task to the deploy step (making sure not to add it to the testing step):</p>
<pre class="highlight"><code class="javascript">grunt.registerTask(<span class="string">"test"</span>, [
  <span class="string">"concat"</span>,
  <span class="string">"jshint"</span>,
  <span class="string">"jasmine"</span>
])
grunt.registerTask(<span class="string">"deploy"</span>, [
  <span class="string">"concat"</span>,
  <em><span class="string">"strip-code"</span></em>,
  <span class="string">"jshint"</span>,
  <span class="string">"uglify"</span>
])</code></pre><p>Now, when you test your code, those test-only blocks will be in the source like you want, but they’ll be stripped out when you deploy to production.</p>
<p>That means you can still maintain 100% test coverage without sacrificing your code structure or design.</p>
<p>It’s the best of both worlds.</p>
<h3 id="a-word-of-caution">A Word of Caution</h3>
<p>There are a lot of pros to this approach, and I certainly favor it over exposing your private functions in an awkward way or not testing them at all, but there is a downside that you should be aware of.</p>
<p>Anytime you change your code between when it’s tested and when it’s deployed, you run the risk of missing something. If you weren’t careful and part of your library depended on the code you removed, your library would break in production, and you might not know about it until long after it shipped.</p>
<p>Luckily, there are two relatively simple strategies to help prevent this. The easiest way is to assign your test only functions to an object namespace that is obviously not intended for normal use. For example:</p>
<pre class="highlight"><code class="javascript"><span class="comment">/* test-code */</span>
<em>api.__testonly__.foo = foo</em>
<span class="comment">/* end-test-code */</span></code></pre><p>Using a namespace like <code>__testonly__</code> not only makes the intent obvious, it also makes it possible to add an additional step to the build process to make sure no <code>__testonly__</code> code appears in the final release.</p>
<p>Another strategy is to split your test suite into two phases. The first phase tests the private functions. The second phase strips the code and then tests the public functions. Here’s an example of that:</p>
<pre class="highlight"><code class="javascript">grunt.registerTask(<span class="string">"test"</span>, [
  <span class="string">"concat"</span>,
  <span class="string">"jshint"</span>,
  <em><span class="string">"jasmine:private"</span></em>,
  <em><span class="string">"strip-code"</span></em>,
  <span class="string">"jshint"</span>,
  <em><span class="string">"jasmine:public"</span></em>
])</code></pre><p>Though not always possible (depending on your test setup), this is probably the safest method as it still tests the public API after stripping out the test-only code.</p>
<p>These two strategies may not be necessary if you’re the only developer or working on a small team, but the more people you have contributing the more caution you’ll need to take. Obviously it’s up to you to determine the right approach for your situation.</p>
<h2 id="conclusion">Conclusion</h2>
<p>To summarize, due to the nature of JavaScript it’s important to not expose too many variables and functions in the global namespace. Using function closures and the module pattern is a great way to hide functionality, but it also makes it harder to test that functionality.</p>
<p>Even though that code may be an implementation detail, merely testing the public API may not give you the peace of mind you need when making code changes in the future.</p>
<p>Testing your code is important, even if it takes a little bit of extra work. This article shows you how you can use a build system to test your private functions without compromising encapsulation and modularity.</p>

  </div>

  <footer class="entry-unrelated">

    <div class="Share">
      <span class="Share-figure">
        <svg viewBox="0 0 39 32">
          <use xlink:href="#icon-twitter-bird"></use>
        </svg>
      </span>
      <p class="Share-pitch">
        If you liked this article and think others should read it, please
        <a data-social-network="Twitter"
           data-social-action="tweet"
           href="http://twitter.com/intent/tweet?text=How%20to%20Unit%20Test%20Private%20Functions%20in%20JavaScript&amp;url=http%3A%2F%2Fphilipwalton.com%2Farticles%2Fhow-to-unit-test-private-functions-in-javascript%2F&amp;via=philwalton">share it on Twitter</a>.
      </p>
    </div>

  </footer>

</article>

      </main>
    </div>

    <script>
(function(window, document, location) {
  (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function(element, event, fn) {
  if (element.addEventListener) {
    element.addEventListener(event, fn, false);
  }
  else {
    element.attachEvent('on' + event, fn);
  }
};

},{}],2:[function(require,module,exports){
/* global ga */

var linkClicked = require('./link-clicked');
var History2 = require('./history2');
var parseUrl = require('./parse-url');

// Cache the container element to avoid multiple lookups.
var container;

// Store the result of page content requests to avoid multiple
// lookups when navigation to a previously seen page.
var pageCache = {};


function getTitle(a) {
  var title = a.title || a.innerText;
  return title ? title + ' \u2014 Philip Walton' : null;
}


function loadPageContent(done) {
  var path = this.nextPage.path;

  if (pageCache[path]) return done();

  var basename = /(\w+)\.html$/;
  var url = basename.test(path) ?
      path.replace(basename, '_$1.html') : path + '_index.html';

  var xhr = new XMLHttpRequest();
  xhr.open('GET', url);
  xhr.onload = function() {
    if (xhr.status >= 200 && xhr.status < 400) {
      pageCache[path] = xhr.responseText;
      done();
    }
    else {
      done(new Error('(' + xhr.status + ') ' + xhr.response));
    }
  };
  xhr.onerror = function() {
    done(new Error('Error making request to:' + url));
  };
  xhr.send();
}


function showPageContent() {
  var content = pageCache[this.nextPage.path];
  container.innerHTML = content;
}


function setScroll() {
  var hash = this.nextPage.hash;
  if (hash) {
    var target = document.getElementById(hash.slice(1));
  }
  var scrollPos = target ? target.offsetTop : 0;

  // TODO: There's a weird chrome bug were sometime this function
  // doesn't do anything if Chrome has already visited this page and
  // thinks it has a scroll position in mind. Just chrome, weird...
  window.scrollTo(0, scrollPos);
}


function trackPage() {
  ga('set', {
    location: this.nextPage.href,
    title: this.nextPage.title
  });
  ga('send', 'pageview');

}


function trackError(error) {
  var url = this.nextPage.href;
  ga('send', 'exception', {
    exDescription: error.stack || error.message,
    exFatal: false,
    hitCallback: function() {
      // If there's an error, attempt to manually navigation to the
      // page. If that fails Github pages will show the actual 404 page.
      location.href = url;
    }
  });
}


module.exports = {

  init: function() {

    // Only load external content via AJAX if the browser support pushState.
    if (!(window.history && window.history.pushState)) return;

    // Add the current page to the cache.
    container = document.querySelector('main');
    pageCache[location.pathname] = container.innerHTML;


    var history2 = new History2()
        .use(loadPageContent)
        .use(showPageContent)
        .use(setScroll)
        .use(trackPage)
        ['catch'](trackError);

    linkClicked(function(event) {

      // Don't attempt to AJAX in content if the link was click
      // while the command (meta) or control key was pressed.
      if (event.metaKey || event.ctrlKey) return;

      var page = parseUrl(location.href);
      var link = parseUrl(this.href);

      // Don't do anything when clicking on links to the current URL.
      if (link.href == page.href) event.preventDefault();

      // If the clicked link is on the same site but has a different path,
      // prevent the browser from navigating there and load the page via ajax.
      if ((link.origin == page.origin) && (link.path != page.path)) {
        event.preventDefault();
        history2.add(link.href, getTitle(this));
      }
    });
  }
};

},{"./history2":3,"./link-clicked":4,"./parse-url":7}],3:[function(require,module,exports){
var parseUrl = require('./parse-url');

function History2() {

  // Store the current url information.
  this.currentPage = parseUrl(window.location.href);
  this.currentPage.title = document.title;

  // Add history state initially so the first `popstate` event contains data.
  history.replaceState(
      this.currentPage,
      this.currentPage.title,
      this.currentPage.href);

  this._queue = [];

  // Listen for popstate changes and log them.
  window.addEventListener('popstate', function(event) {
    var state = event.state;
    var title = state && state.title;
    this.add(window.location.href, title, state, event);
  }.bind(this));
}


History2.prototype.add = function(url, title, state, event) {

  // Ignore urls pointing to the current address
  if (url == this.currentPage.href) return;

  this.nextPage = parseUrl(url);
  this.nextPage.title = title;
  this.nextPage.state = state;

  this._processQueue(event);
};


/**
 * Register a plugin with the History2 instance.
 * @param {Function(History2, done)} - A plugin that runs some task and
 *     informs the next plugin in the queue when it's done.
 */
History2.prototype.use = function(plugin) {
  this._queue.push(plugin);

  return this;
};

/**
 * Register a handler to catch any errors.
 * Note: In ES3 reserved words like "catch" couldn't be used as property names:
 * http://kangax.github.io/compat-table/es5/#Reserved_words_as_property_names
 * @param {Function(Error)} - The function to handle the error.
 */
History2.prototype['catch'] = function(onError) {
  this._onError = onError;

  return this;
};


History2.prototype._onError = function(error) {
  // Left blank so calling `_onError` never fails.
  console.error(error.stack);
};


History2.prototype._onComplete = function(event) {

  // Popstate triggered navigation is already handled by the browser,
  // so we only add to the history in non-popstate cases.
  if (!(event && event.type == 'popstate')) {
    history.pushState(
        this.nextPage,
        this.nextPage.title,
        this.nextPage.href);
  }

  if (this.nextPage.title) document.title = this.nextPage.title;

  // Update the last url to the current url
  this.currentPage = this.nextPage;
  this.nextPage = null;
};


History2.prototype._processQueue = function(event) {
  var self = this;
  var i = 0;

  (function next() {

    var plugin = self._queue[i++];
    var isSync = plugin && !plugin.length;

    if (!plugin) return self._onComplete(event);

    // The callback for async plugins.
    function done(error) {
      if (error) {
        self._onError(error);
      }
      else {
        next();
      }
    }

    try {
      plugin.apply(self, isSync ? [] : [done]);
    }
    catch(error) {
      return self._onError(error);
    }

    // Sync plugins are done by now and can immediately process
    // the next item in the queue.
    if (isSync) next();

  }());
};


module.exports = History2;

},{"./parse-url":7}],4:[function(require,module,exports){
var addListener = require('./add-listener');

function isLink(el) {
  return el.nodeName && el.nodeName.toLowerCase() == 'a' && el.href;
}

function getLinkAncestor(el) {
  if (isLink(el)) return el;
  while (el.parentNode && el.parentNode.nodeType == 1) {
    if (isLink(el)) return el;
    el = el.parentNode;
  }
}

module.exports = function(fn) {
  addListener(document, 'click', function(event) {
    var e = event || window.event;
    var target = e.target || e.srcElement;
    var link = getLinkAncestor(target);
    if (link) {
      fn.call(link, e);
    }
  });
};

},{"./add-listener":1}],5:[function(require,module,exports){
var supports = require('./supports');
var outboundLinks = require('./outbound-links');
var socialInteractions = require('./social-interactions');
var contentLoader = require('./content-loader');


// Add an `is-legacy` class on browsers that don't supports flexbox.
if (!supports.flexbox()) {
  document.documentElement.className += ' is-legacy';
}


// Track when the user clicks a link to an external site.
outboundLinks.track();


// Track when the user clicks a social link.
socialInteractions.track();


// Load links via AJAX instead of full page loads in browsers with pushState.
contentLoader.init();

},{"./content-loader":2,"./outbound-links":6,"./social-interactions":8,"./supports":9}],6:[function(require,module,exports){
/* global ga */

var parseUrl = require('./parse-url');
var linkClicked = require('./link-clicked');

function isExternalLink(link) {
  var url = parseUrl(link.href);
  var loc = parseUrl(location.href);
  return url.origin != loc.origin;
}

module.exports = {
  track: function() {
    linkClicked(function() {
      if (isExternalLink(this)) {

        // Opening links in an external tabs allows the ga beacon to send.
        // When following links directly, sometimes they don't make it.
        this.target = '_blank';

        ga('send', 'event', 'Outbound Link', 'click', this.href);
      }
    });

  }
};


},{"./link-clicked":4,"./parse-url":7}],7:[function(require,module,exports){
var a = document.createElement('a');
var cache = {};

/**
 * Parse the given url and return the properties returned
 * by the `Location` object.
 * @param {string} url - The url to parse.
 * @return {Object} An object with the same keys as `window.location`.
 */
module.exports = function(url) {

  if (cache[url]) return cache[url];

  var httpPort = /:80$/;
  var httpsPort = /:443/;

  a.href = url;

  // Sometimes IE will return no port or just a colon, especially for things
  // like relative port URLs (e.g. "//google.com").
  var protocol = !a.protocol || ':' == a.protocol ?
      location.protocol : a.protocol;

  // Don't include default ports.
  var port = (a.port == '80' || a.port == '443') ? '' : a.port;

  // Sometimes IE incorrectly includes a port (e.g. `:80` or `:443`)  even
  // when no port is specified in the URL.
  // http://bit.ly/1rQNoMg
  var host = a.host.replace(protocol == 'http:' ? httpPort : httpsPort, '');

  // Not all browser support `origin` so we have to build it.
  var origin = a.origin ? a.origin : protocol + '//' + host;

  // Sometimes IE doesn't include the leading slash for pathname.
  // http://bit.ly/1rQNoMg
  var pathname = a.pathname.charAt(0) == '/' ? a.pathname : '/' + a.pathname;

  return cache[url] = {
    hash: a.hash,
    host: host,
    hostname: a.hostname,
    href: a.href,
    origin: origin,
    path: pathname + a.search,
    pathname: pathname,
    port: port,
    protocol: protocol,
    search: a.search
  };
};

},{}],8:[function(require,module,exports){
/* global ga */

var linkClicked = require('./link-clicked');

module.exports = {
  track: function() {
    linkClicked(function() {
      var socialNetwork = this.getAttribute('data-social-network');
      if (socialNetwork) {
        var socialAction = this.getAttribute('data-social-action');
        var socialTarget = location.href;

        // Opening links in an external tabs allows the ga beacon to send.
        // When following links directly, sometimes they don't make it.
        this.target = '_blank';

        ga('send', 'social', socialNetwork, socialAction, socialTarget);
      }
    });
  }
};

},{"./link-clicked":4}],9:[function(require,module,exports){
var supports = {};
var style = document.body.style;

module.exports = {
  flexbox: function() {
    return supports.flexbox || (supports.flexbox = ('flexBasis' in style ||
        'msFlexAlign' in style || 'webkitBoxDirection' in style));
  }
};

},{}]},{},[5]);

}(window, document, location));
</script>

<!-- Load GA after the `window.ga` is initialized or you'll get errors. -->


  <script async src="//www.google-analytics.com/analytics_debug.js"></script>



  </body>
</html>
