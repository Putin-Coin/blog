<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<link rel="subresource" src="//use.typekit.net/ayq0lpd.js"/>
<link rel="subresource" src="//www.google-analytics.com/analytics.js"/>

<title>Stop Copying Social Code Snippets &mdash; Philip Walton</title>

<!--[if lt IE 9]><script src="/assets/javascript/html5shiv.js"></script><![endif]-->

<!-- Put typekit in the head for the fastest possible download. -->
<script src="//use.typekit.net/ayq0lpd.js"></script>

<script>
ga = function() { ga.q.push(arguments); };
ga.q = []; ga.l = 1 * new Date();

// Create the GA tracker before doing any logging.
ga('create', 'UA-21292978-1', 'auto');



  // In non-production mode, simply log GA hits to the console.
  ga(function(tracker) {
    tracker.set('sendHitTask', function() {
      // Throw to stop subsequent tasks.
      throw 'Abort tracking in non-production environments.'
    });
  });



// Initialize typekit and track how frequently it fails.
try {
  Typekit.load();
}
catch(err) {
  ga('send', 'exception', {
    exDescription: err.stack || err.message,
    exFatal: false
  });
}


// Track uncaught errors via Google Analytics.
window.onerror = function(message, url, line, col) {
  var desc = message + ' (line: ' + line + ', url: ' + url + ', col: '
      + col + ')';
  ga('send', 'exception', {
    exDescription: 'window.onerror: ' + desc,
    exFatal: false
  });
};


// Note, tasks must be set before sending the first hit
ga('send', 'pageview');
</script>


<link href="/assets/css/style.css" rel="stylesheet">
<link href="http://feeds.feedburner.com/philipwalton" rel="alternate" title="Philip Walton" type="application/atom+xml">

<meta name="description" content="If you’re a web developer, chances are, at some point, you’ve had to add a social">
<meta name="viewport" content="width=device-width, initial-scale=1">

<svg display="none">
  <defs>
    <path id="icon-twitter-bird" d="M34.7 5c1.7-1 2.8-2.5 3.4-4.4-1.6 0.9-3.3 1.6-5 2-1.6-1.7-3.6-2.6-5.8-2.6-2.2 0-4.2 0.7-5.7 2.3-1.6 1.6-2.3 3.4-2.3 5.8 0 0.6 0.1 1.2 0.2 1.8-6.9-0.4-12.6-3.2-16.9-8.5-0.7 1.2-1.1 2.7-1.1 4.1 0 3 1.2 5.2 3.6 6.8-1.2 0-2.5-0.4-3.6-1v0.1c0 2 0.6 3.7 1.8 5.2 1.2 1.5 2.7 2.5 4.6 2.8-0.6 0.1-1.2 0.2-2.1 0.2-0.4 0-0.9 0-1.5-0.1 0.5 1.5 1.4 2.8 2.8 3.8 1.4 1 3 1.5 4.7 1.6-3.1 2.5-6.4 3.7-10 3.7-0.5 0-1.1 0-2-0.1 3.7 2.2 7.8 3.4 12.4 3.4 3.6 0 6.8-0.7 9.8-2.1 3-1.4 5.4-3.2 7.3-5.4 1.8-2.2 3.3-4.7 4.3-7.4s1.6-5.4 1.6-8.1v-1c1.4-1 2.7-2.5 3.9-4.2-1.6 0.6-3.2 1.1-4.7 1.2z"></path>
    <path id="icon-rss" d="M16 0q6.6 0 11.3 4.7t4.7 11.3q0 6.6-4.7 11.3t-11.3 4.7-11.3-4.7-4.7-11.3 4.7-11.3 11.3-4.7zM10.7 24q1.1 0 1.9-0.8t0.8-1.9-0.8-1.9-1.9-0.8-1.9 0.8-0.8 1.9 0.8 1.9 1.9 0.8zM16.7 24h3.3q0-5-3.5-8.5t-8.5-3.5v3.3q3.6 0 6.1 2.5t2.5 6.1zM22.7 24h3.3q0-3.7-1.4-7t-3.8-5.7-5.7-3.8-7-1.4v3.3q6.1 0 10.4 4.3t4.3 10.4z"></path>
    <path id="icon-twitter" d="M16 0q6.6 0 11.3 4.7t4.7 11.3-4.7 11.3-11.3 4.7-11.3-4.7-4.7-11.3 4.7-11.3 11.3-4.7zM25.7 12.5q1.2-0.9 2.3-2.3-1.3 0.6-2.6 0.7 1.4-0.8 2-2.5-1.4 0.8-2.9 1.1-1.3-1.4-3.3-1.4-1.9 0-3.2 1.3t-1.3 3.2q0 0.6 0.1 1-5.7-0.3-9.4-4.8-0.6 1.1-0.6 2.3 0 2.4 2 3.8-1 0-2-0.6v0q0 1.6 1 2.9t2.6 1.6q-0.5 0.1-1.2 0.1-0.3 0-0.9-0.1 0.4 1.4 1.6 2.2t2.6 0.9q-2.6 2.1-5.6 2.1-0.4 0-1.1-0.1 3.1 2 7 2 3 0 5.5-1.2t4.1-3.1 2.4-4.1 0.9-4.6v-0.6z"></path>
    <path id="icon-github" d="M16 0q6.59 0 11.3 4.7t4.7 11.3q0 5.52-3.39 9.85t-8.61 5.67v-4.18q0-2.89-1.67-4.18 3.37-0.52 5.52-2.41t2.15-4.74q0-2.52-1.85-4.59 0.67-3.07-0.15-4.74-2.04 0.19-4.63 1.78-1.78-0.44-3.37-0.44t-3.37 0.44q-2.59-1.59-4.63-1.78-0.85 1.78-0.15 4.74-1.85 2.07-1.85 4.59 0 2.85 2.15 4.74t5.52 2.41q-0.85 0.63-1.3 1.82-0.67 0-1.37-0.13t-1.28-0.35-1.11-0.5-0.96-0.56-0.72-0.52-0.48-0.39l-0.15-0.15q-0.26-0.26-0.52-0.07-0.3 0.19-0.22 0.52 0.7 1.37 1.19 2 1.93 2.48 5.26 3.48v3.22q-5.22-1.33-8.61-5.67t-3.39-9.85q0-6.63 4.68-11.31t11.32-4.68z"></path>
  </defs>
</svg>


  </head>
  <body class="Site">

    <div class="Site-header">
      <header class="Header">
        <a class="Header-info" href="/" title="Home">
          <h1 class="Header-title">Philip Walton</h1>
          <p class="Header-tagline">Engineer at Google</p>
        </a>
        <a class="Header-photo" href="/" title="Home"></a>
        <div class="Header-social">
          <nav class="SocialNav">
  <a class="SocialNav-icon SocialNav-icon--twitter"
     href="https://twitter.com/philwalton"
     title="Twitter">
    <svg viewBox="0 0 32 32">
      <use xlink:href="#icon-twitter"></use>
    </svg>
  </a>
  <a class="SocialNav-icon SocialNav-icon--github"
     href="https://github.com/philipwalton"
     title="Github">
    <svg viewBox="0 0 32 32">
      <use xlink:href="#icon-github"></use>
    </svg>
  </a>
  <a class="SocialNav-icon SocialNav-icon--rss"
     href="http://feeds.feedburner.com/philipwalton"
     title="RSS">
    <svg viewBox="0 0 32 32">
      <use xlink:href="#icon-rss"></use>
    </svg>
  </a>
</nav>
        </div>
        <div class="Header-nav">
          <nav class="MainNav">
  <a href="/" title="Home">Home</a>
  <a href="/articles/" title="Articles">Articles</a>
  <a href="/about/" title="About">About</a>
</nav>
        </div>
      </header>
    </div>

    <div class="Site-contentContainer">
      <main class="Site-content">
        
<article role="article" class="hentry">

  <header class="ContentHeader">
    <h1 class="ContentHeader-title entry-title">Stop Copying Social Code Snippets</h1>
    <time class="ContentHeader-date published"
        datetime="2014-04-20T16:17:32-07:00">
      April 20, 2014
    </time>
  </header>

  <div class="entry-content">
    <p>If you’re a web developer, chances are, at some point, you’ve had to add a social widget to one of your page. Actually, probably more than one. And chances are you didn’t want to put too much thought into it, so you just copied some code from the Internet and called it a day. Done and done.</p>
<p>I mean, the Web is filled with code that has been blindly copied from one source to another. Tweet buttons, Like buttons, Disqus comments, Google Analytics, all of these come with nice, neat, prepackaged code snippets.</p>
<p>In case you haven’t figured it out from the title (and my tone), I think using these snippets is a bad idea.</p>
<p>If you’re a professional web developer, these snippets are not for you. They’re for your friends and relatives, your uncle’s restaurant business or your sister’s baby blog, but they’re not for you.</p>
<p>One size fits all solutions can never been optimized for all cases, and they frequently come with baggage you don’t want or need.</p>
<p>If you care about performance, reusability, and clean code, then you should make an effort to avoid this temptation. Rise to the challenge, as a professional, and take the two seconds it requires to figure out what the code is doing. Maybe you don’t actually need it, or maybe you can do it better.</p>
<h2 id="the-myths-of-social-widgets">The Myths of Social Widgets</h2>
<p>Now, you might be thinking to yourself: “but this code was written by a super genius at [insert big company name here] and its been tested on millions and millions of websites; I don’t want to mess with that.”</p>
<p>The first part of this sentiment is absolutely not true. The people who wrote these snippets are just like you and me, and the complexity of the code is so minimal that the intelligence of the author is irrelevant. In any case, the source is right there, so you can learn from their genius.</p>
<p>The second part of this sentiment (the testing part) may be a legitimate concern in general, but I don’t think it really applies to social widget code. These snippets are only a couple of lines at most, and usually, either they work or they don’t. If you don’t see any JavaScript errors in the console, and the widgets actually load in the browsers you’re targeting, that’s pretty much all the testing you need.</p>
<p>Note that this doesn’t actually require additional testing on your part since you should be checking that these widgets work in your target browsers anyway. There’s always the possibility that something you’re doing is conflicting with the recommended snippets, so regardless of what you do, you still have to test that it works.</p>
<h2 id="the-anatomy-of-a-social-code-snippet">The Anatomy of a Social Code Snippet</h2>
<p>Almost every social snippet out there does the same two things:</p>
<ol>
<li>It adds a placeholder element to the HTML.</li>
<li>It loads a script from their site that adds some stuff to the placeholder.</li>
</ol>
<p>That’s it. Don’t believe me? Well, let’s look at a few examples.</p>
<p><em>(If you do believe me and just want to skip to my recommendations, go to the section entitled <a href="#what-to-do-instead">What To Do Instead</a>.)</em></p>
<h3 id="twitter">Twitter</h3>
<p>Here is the code that <a href="https://dev.twitter.com/docs/tweet-button">developers.twitter.com</a> recommends you use to get a tweet button on your site.</p>
<pre class="highlight"><code class="xml"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"http://example.com"</span> <span class="attribute">class</span>=<span class="value">"twitter-share-button"</span> <span class="attribute">data-lang</span>=<span class="value">"en"</span>&gt;</span>Tweet<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">!<span class="function"><span class="keyword">function</span><span class="params">(d,s,id)</span>{</span><span class="keyword">var</span> js,fjs=d.getElementsByTagName(s)[<span class="number">0</span>];<span class="keyword">if</span>(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=<span class="string">"https://platform.twitter.com/widgets.js"</span>;fjs.parentNode.insertBefore(js,fjs);}}(document,<span class="string">"script"</span>,<span class="string">"twitter-wjs"</span>);</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></code></pre><p>Don’t let the fact that it’s all minified and obfuscated intimidate you. This is very basic code that I’m confident you can understand.</p>
<p>The HTML part is pretty straight forward. It’s just a plain old link with the class <code>twitter-share-button</code>. This is the placeholder element that I mentioned above.</p>
<p>The JavaScript portion is a bit more complex, so let me prettify the code a bit and replace the single letter variables so you can get a clearer picture of what’s going on.</p>
<pre class="highlight"><code class="javascript"><span class="keyword">var</span> js, fjs = document.getElementsByTagName(<span class="string">'script'</span>)[<span class="number">0</span>];
<span class="keyword">if</span> (!document.getElementById(<span class="string">'twitter-wjs'</span>)) {
  js = document.createElement(<span class="string">'script'</span>);
  js.id = <span class="string">'twitter-wjs'</span>;
  js.src = <span class="string">'https://platform.twitter.com/widgets.js'</span>;
  fjs.parentNode.insertBefore(js, fjs);
}</code></pre><p>Let’s walk through what this code is doing.</p>
<ol>
<li>It declares the variables <code>js</code> and <code>fjs</code>, and assigns <code>fjs</code> to the first script element on the page.</li>
<li>It then checks to see if the document already has an element with the ID “twitter-wjs”. If it does, nothing happens. If it doesn’t, it goes into the if conditional.</li>
<li>It creates a new script element, assigns it to the <code>js</code> variable, and sets the ID to <code>twitter-wjs</code> and the <code>src</code> attribute to <code>https://platform.twitter.com/widgets.js</code>.</li>
<li>Finally, it inserts the script element into the DOM immediately before the first script element.</li>
</ol>
<p>This is actually very uncomplicated code. All it’s doing is downloading an external script and running it on your page.</p>
<p>It does a single check to make sure the script hasn’t already been downloaded, which is important because so many people blindly paste this code multiple times onto the same page, and obviously the same script file doesn’t need to be downloaded more than once.</p>
<p>Well, that was Twitter, now let’s take a look at another snippet.</p>
<h3 id="facebook">Facebook</h3>
<pre class="highlight"><code class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"fb-root"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">(<span class="function"><span class="keyword">function</span><span class="params">(d, s, id)</span> {</span>
  <span class="keyword">var</span> js, fjs = d.getElementsByTagName(s)[<span class="number">0</span>];
  <span class="keyword">if</span> (d.getElementById(id)) <span class="keyword">return</span>;
  js = d.createElement(s); js.id = id;
  js.src = <span class="string">"//connect.facebook.net/en_US/all.js"</span>;
  fjs.parentNode.insertBefore(js, fjs);
}(document, <span class="string">'script'</span>, <span class="string">'facebook-jssdk'</span>));</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="comment">&lt;!-- then put the share button somewhere --&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"fb-share-button"</span> <span class="attribute">data-href</span>=<span class="value">"http://example.com"</span> <span class="attribute">data-type</span>=<span class="value">"button_count"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></code></pre><p>Facebook’s code is a little less obfuscated, so this snippet is a bit easier to read. Can you see how similar it is? They even use the exact same variable names: <code>d</code>, <code>s</code>, and <code>id</code>, <code>js</code>, and <code>fjs</code>.</p>
<h3 id="disqus">Disqus</h3>
<pre class="highlight"><code class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"disqus_thread"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
<span class="keyword">var</span> disqus_shortname = <span class="string">''</span>; <span class="comment">// required: replace example with your forum shortname</span>
(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
<span class="keyword">var</span> dsq = document.createElement(<span class="string">'script'</span>);
dsq.type = <span class="string">'text/javascript'</span>;
dsq.async = <span class="literal">true</span>;
dsq.src = <span class="string">'//'</span> + disqus_shortname + <span class="string">'.disqus.com/embed.js'</span>;
(document.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>] || document.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>]).appendChild(dsq);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></code></pre><p>The Disqus snippet is slightly different because it requires you to assign your Disqus username to the variable <code>disqus_shortname</code> and then it downloads a script from that subdomain. But there are also difference in how it loads the external script:</p>
<ul>
<li>It adds the <code>type</code> attribute “text/javascript” to the script element.</li>
<li>It adds the <code>async</code> attribute.</li>
<li>It appends the newly created script element to the <code>&lt;head&gt;</code> (or to the <code>&lt;body&gt;</code> if <code>&lt;head&gt;</code> can’t be found) rather that inserting it before the first script element.</li>
</ul>
<p>You might be asking yourself. Are these differences important? Disqus is a big name company, surely they’re doing things differently for a reason, right?</p>
<p>To answer this question bluntly: no, these differences are not important.</p>
<p>First of all, it’s totally unnecessary to set a script’s <code>type</code> attribute to “text/javascript” if you’re using an html5 doctype (which you probably are). Secondly, it’s unnecessary to check for the presence of the <code>&lt;head&gt;</code> element since all browsers automatically add that when creating the DOM (even if it’s not present in the source). Finally, the <code>async</code> attribute is added to the script to prevent it from blocking during download; however, any script that is dynamically added to the DOM is evaluated as async by default.</p>
<p>I’m going to give Disqus the benefit of the doubt and assume that they had a good reason for writing the code they did. Perhaps they had some big enterprise client with really old, invalid HTML, parsing errors, and no doctype, and this was the solution they needed to get it working for them. I don’t know, but the point is these differences don’t apply to you, so there’s no reason to carry someone else’s baggage.</p>
<p>This also helps disprove the first myth about social snippets. Just because some big name company is doing it a certain way, doesn’t mean that’s a best-practice.</p>
<h3 id="google-analytics">Google Analytics</h3>
<p>Google Analytics is a little bit more complicated than the other social snippets. In addition to downloading an external script, it also creates a function on the page that the external script needs to interact with.</p>
<p>Here’s the Google Analytics snippet, formatted so it’s a bit easier to read:</p>
<pre class="highlight"><code class="javascript">(<span class="function"><span class="keyword">function</span><span class="params">(i, s, o, g, r, a, m)</span> {</span>
  i[<span class="string">'GoogleAnalyticsObject'</span>] = r;
  i[r] = i[r] || <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    (i[r].q = i[r].q || []).push(arguments)
  }, i[r].l = <span class="number">1</span> * <span class="keyword">new</span> Date();
  a = s.createElement(o),
  m = s.getElementsByTagName(o)[<span class="number">0</span>];
  a.async = <span class="number">1</span>;
  a.src = g;
  m.parentNode.insertBefore(a, m)
})(window, document, <span class="string">'script'</span>, <span class="string">'//www.google-analytics.com/analytics.js'</span>, <span class="string">'ga'</span>);

ga(<span class="string">'create'</span>, <span class="string">'UA-XXXX-Y'</span>, <span class="string">'auto'</span>);
ga(<span class="string">'send'</span>, <span class="string">'pageview'</span>);</code></pre><p>While this code is definitely more involved than the other snippets, and changing it will increase the risk of things breaking. I’d still recommend you don’t blindly paste it into your website.</p>
<p>The Google Analytics developer documentation has an <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/advanced#snippetReference">unminified and commented version of this script</a>, and I highly suggest looking at that to see what’s actually going on.</p>
<p>To spoil the mystery, unless you’re doing something custom, my version below will work just fine:</p>
<pre class="highlight"><code class="javascript">ga = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  ga.q.push(arguments);
};
ga.q = [[<span class="string">'create'</span>, <span class="string">'UA-XXXX-Y'</span>, <span class="string">'auto'</span>], [<span class="string">'send'</span>, <span class="string">'pageview'</span>]];
ga.l = <span class="number">1</span> * <span class="keyword">new</span> Date();</code></pre><p>This updated snippet creates a <code>ga</code> function that, when invoked, pushes the arguments passed onto its <code>q</code> property. It then initializes the <code>q</code> property with your tracker data and stores the current time on the <code>l</code> property.</p>
<p>This new code does the exact same thing as the original snippet, but it’s vastly simplified since it doesn’t try to support all possible custom use cases.</p>
<p>All you have to do is load the external script yourself, and everything should work as normal.</p>
<h2 id="what-to-do-instead">What To Do Instead</h2>
<p>While using asynchronous script loading is certainly better than a bunch of blocking scripts littered throughout the page, its no magic bullet. Asynchronous scripts don’t block rendering, but they do delay page loads.</p>
<p>If you add a script element to the DOM before the window’s <code>load</code> event fires, that event will be delayed until the newly added script is downloaded, parsed, and run. If you’re adding multiple scripts (most people are), the <code>load</code> event could be delayed a long time.</p>
<p>Now, you might be thinking to yourself. Who cares about <code>load</code>? Isn’t <code>DOMContentLoaded</code> the event I should really be worried about? Isn’t that what we learned from jQuery?</p>
<p><code>DOMContentLoaded</code> is the event that fires once the document has been fully parsed and is able to be traversed by scripts. If you’re waiting to do some DOM manipulation, then yes, this is the event you should care about.</p>
<p>But the window’s <code>load</code> event is just as important, arguably more so, and for a few reasons:</p>
<ul>
<li>Google search ranking algorithms take page load times into account, and those page load times are based on the <code>load</code> event.</li>
<li>If the URL has a hash fragment, browsers will not scroll down to that location until after the <code>load</code> event fires. This can significantly affect how snappy your page feels.</li>
<li>Browser plugins commonly listen for the <code>load</code> event, so any plugins your visitors have could make your pages seem slower than they really are.</li>
</ul>
<p>I’m sure there are many more reasons to care about the <code>load</code> event, but this list is convincing enough for me.</p>
<p>Given all of this, you have two choices for how to implement your social widgets. And your decision should depend solely on how essential these widgets are to your user experience:</p>
<ul>
<li>If they’re essential, they shouldn’t be asychronously loaded at all.</li>
<li>If they’re non-essential (which is usually the case), you should wait until after the <code>load</code> event to download and intialize them.</li>
</ul>
<h3 id="waiting-until-after-page-load">Waiting Until After Page Load</h3>
<p>Since none of the snippets we’ve look at thus far wait for the <code>load</code> event, we’ll have to implement our own script loader. This is easy as we’ve already seen many examples for how to do it. Here’s a basic implementation:</p>
<pre class="highlight"><code class="javascript"><span class="keyword">var</span> getScript = (<span class="function"><span class="keyword">function</span><span class="params">(firstScript)</span> {</span>
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(src)</span> {</span>
    <span class="keyword">var</span> script = document.createElement(<span class="string">'script'</span>);
    script.src = src;
    firstScript.parentNode.insertBefore(script, firstScript);
  }
}(document.getElementsByTagName(<span class="string">'script'</span>)[<span class="number">0</span>]));</code></pre><p>The above code caches a reference to the first script on the page (to avoid multiple DOM lookups), then it returns a function that adds your new script element right before the first script.</p>
<p>Once you have a script loading function, just use it in the <code>window.onload</code> callback.</p>
<pre class="highlight"><code class="javascript">window.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  getScript(<span class="string">'//www.google-analytics.com/analytics.js'</span>);
  getScript(<span class="string">'//philipwalton.disqus.com/embed.js'</span>);
  getScript(<span class="string">'https://platform.twitter.com/widgets.js'</span>);
  getScript(<span class="string">'//connect.facebook.net/en_US/all.js'</span>);
};</code></pre><p>If you’re using a library like jQuery, then you don’t even need to write the script loading code at all. jQuery can do that for you. (As can many other libraries, so check your dependencies before reinventing the wheel.)</p>
<pre class="highlight"><code class="javascript">$(window).on(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  $.getScript(<span class="string">'//www.google-analytics.com/analytics.js'</span>);
  $.getScript(<span class="string">'//philipwalton.disqus.com/embed.js'</span>);
  $.getScript(<span class="string">'https://platform.twitter.com/widgets.js'</span>);
  $.getScript(<span class="string">'//connect.facebook.net/en_US/all.js'</span>);
});</code></pre><p>It’s important to note that some of these social snippets (like Google Analytics) still require initialization, so don’t forget about those parts.</p>
<h3 id="bundling-the-external-scripts-with-your-main-javascript-file">Bundling the External Scripts With Your Main JavaScript File</h3>
<p>If one or more of these third party widgets are critical to your user experience, then you should be loading them immediately, not asynchronously.</p>
<p>To do this you’ll need to add a step to your build process that downloads these external dependencies, bundles them with your other scripts, and produces a single, minified JavaScript file that is loaded immediately preceding the closing <code>&lt;/body&gt;</code> tag.</p>
<p>In many ways, downloading and serving these social scripts yourself is safer and more resilient than loading them on the fly from a domain you don’t control. In fact, you could even take this approach if you’re loading these scripts after the <code>load</code> event. Bundling them together reduces the total number of requests and it allows you to control exactly what code (and what version of that code) is being run.</p>
<p>On the other hand, if your users have those social scripts cached (as many do) bundling them will negate that performance benefit. You’ll have to weigh the pros and cons of each approach for yourself.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I know that copying and pasting social code is dead simple. And I know that trying to figure out what each snippet is doing (and then optimizing it for your specific needs) will take time. But I hope this article gives you the courage and the motivation to try. At the very least, if you’re going to use someone’s pre-packaged code, you should have a good reason.</p>
<p>In addition, I hope that more companies will follow the example set by Google Analytics and post an unminified, commented version of their snippets on their developer sites. There’s no reason to force users into the lowest common denominator. Give your non-savvy users the simplest option, but don’t assume your more technical users aren’t capable of customizing the code to fit their needs.</p>
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="http://www.html5rocks.com/en/tutorials/speed/script-loading/">Deep dive into the murky waters of script loading</a></li>
<li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/scripting-1.html">WHATWG Scripting Spec</a></li>
</ul>

  </div>

  <footer class="entry-unrelated">

    <div class="Share">
      <span class="Share-figure">
        <svg viewBox="0 0 39 32">
          <use xlink:href="#icon-twitter-bird"></use>
        </svg>
      </span>
      <p class="Share-pitch">
        If you liked this article and think others should read it, please
        <a data-social-network="Twitter"
           data-social-action="tweet"
           href="http://twitter.com/intent/tweet?text=Stop%20Copying%20Social%20Code%20Snippets&amp;url=http%3A%2F%2Fphilipwalton.com%2Farticles%2Fstop-copying-social-code-snippets%2F&amp;via=philwalton">share it on Twitter</a>.
      </p>
    </div>

  </footer>

</article>

      </main>
    </div>

    <script>
(function(window, document, location) {
  (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function(element, event, fn) {
  if (element.addEventListener) {
    element.addEventListener(event, fn, false);
  }
  else {
    element.attachEvent('on' + event, fn);
  }
};

},{}],2:[function(require,module,exports){
/* global ga */

var linkClicked = require('./link-clicked');
var History2 = require('./history2');
var parseUrl = require('./parse-url');

// Cache the container element to avoid multiple lookups.
var container;

// Store the result of page content requests to avoid multiple
// lookups when navigation to a previously seen page.
var pageCache = {};


function getTitle(a) {
  var title = a.title || a.innerText;
  return title ? title + ' \u2014 Philip Walton' : null;
}


function loadPageContent(done) {
  var path = this.nextPage.path;

  if (pageCache[path]) return done();

  var basename = /(\w+)\.html$/;
  var url = basename.test(path) ?
      path.replace(basename, '_$1.html') : path + '_index.html';

  var xhr = new XMLHttpRequest();
  xhr.open('GET', url);
  xhr.onload = function() {
    if (xhr.status >= 200 && xhr.status < 400) {
      pageCache[path] = xhr.responseText;
      done();
    }
    else {
      done(new Error('(' + xhr.status + ') ' + xhr.response));
    }
  };
  xhr.onerror = function() {
    done(new Error('Error making request to:' + url));
  };
  xhr.send();
}


function showPageContent() {
  var content = pageCache[this.nextPage.path];
  container.innerHTML = content;
}


function setScroll() {
  var hash = this.nextPage.hash;
  if (hash) {
    var target = document.getElementById(hash.slice(1));
  }
  var scrollPos = target ? target.offsetTop : 0;

  // TODO: There's a weird chrome bug were sometime this function
  // doesn't do anything if Chrome has already visited this page and
  // thinks it has a scroll position in mind. Just chrome, weird...
  window.scrollTo(0, scrollPos);
}


function trackPage() {
  ga('set', {
    location: this.nextPage.href,
    title: this.nextPage.title
  });
  ga('send', 'pageview');

}


function trackError(error) {
  var url = this.nextPage.href;
  ga('send', 'exception', {
    exDescription: error.stack || error.message,
    exFatal: false,
    hitCallback: function() {
      // If there's an error, attempt to manually navigation to the
      // page. If that fails Github pages will show the actual 404 page.
      location.href = url;
    }
  });
}


module.exports = {

  init: function() {

    // Only load external content via AJAX if the browser support pushState.
    if (!(window.history && window.history.pushState)) return;

    // Add the current page to the cache.
    container = document.querySelector('main');
    pageCache[location.pathname] = container.innerHTML;


    var history2 = new History2()
        .use(loadPageContent)
        .use(showPageContent)
        .use(setScroll)
        .use(trackPage)
        ['catch'](trackError);

    linkClicked(function(event) {

      // Don't attempt to AJAX in content if the link was click
      // while the command (meta) or control key was pressed.
      if (event.metaKey || event.ctrlKey) return;

      var page = parseUrl(location.href);
      var link = parseUrl(this.href);

      // Don't do anything when clicking on links to the current URL.
      if (link.href == page.href) event.preventDefault();

      // If the clicked link is on the same site but has a different path,
      // prevent the browser from navigating there and load the page via ajax.
      if ((link.origin == page.origin) && (link.path != page.path)) {
        event.preventDefault();
        history2.add(link.href, getTitle(this));
      }
    });
  }
};

},{"./history2":3,"./link-clicked":4,"./parse-url":7}],3:[function(require,module,exports){
var parseUrl = require('./parse-url');

function History2() {

  // Store the current url information.
  this.currentPage = parseUrl(window.location.href);
  this.currentPage.title = document.title;

  // Add history state initially so the first `popstate` event contains data.
  history.replaceState(
      this.currentPage,
      this.currentPage.title,
      this.currentPage.href);

  this._queue = [];

  // Listen for popstate changes and log them.
  window.addEventListener('popstate', function(event) {
    var state = event.state;
    var title = state && state.title;
    this.add(window.location.href, title, state, event);
  }.bind(this));
}


History2.prototype.add = function(url, title, state, event) {

  // Ignore urls pointing to the current address
  if (url == this.currentPage.href) return;

  this.nextPage = parseUrl(url);
  this.nextPage.title = title;
  this.nextPage.state = state;

  this._processQueue(event);
};


/**
 * Register a plugin with the History2 instance.
 * @param {Function(History2, done)} - A plugin that runs some task and
 *     informs the next plugin in the queue when it's done.
 */
History2.prototype.use = function(plugin) {
  this._queue.push(plugin);

  return this;
};

/**
 * Register a handler to catch any errors.
 * Note: In ES3 reserved words like "catch" couldn't be used as property names:
 * http://kangax.github.io/compat-table/es5/#Reserved_words_as_property_names
 * @param {Function(Error)} - The function to handle the error.
 */
History2.prototype['catch'] = function(onError) {
  this._onError = onError;

  return this;
};


History2.prototype._onError = function(error) {
  // Left blank so calling `_onError` never fails.
  console.error(error.stack);
};


History2.prototype._onComplete = function(event) {

  // Popstate triggered navigation is already handled by the browser,
  // so we only add to the history in non-popstate cases.
  if (!(event && event.type == 'popstate')) {
    history.pushState(
        this.nextPage,
        this.nextPage.title,
        this.nextPage.href);
  }

  if (this.nextPage.title) document.title = this.nextPage.title;

  // Update the last url to the current url
  this.currentPage = this.nextPage;
  this.nextPage = null;
};


History2.prototype._processQueue = function(event) {
  var self = this;
  var i = 0;

  (function next() {

    var plugin = self._queue[i++];
    var isSync = plugin && !plugin.length;

    if (!plugin) return self._onComplete(event);

    // The callback for async plugins.
    function done(error) {
      if (error) {
        self._onError(error);
      }
      else {
        next();
      }
    }

    try {
      plugin.apply(self, isSync ? [] : [done]);
    }
    catch(error) {
      return self._onError(error);
    }

    // Sync plugins are done by now and can immediately process
    // the next item in the queue.
    if (isSync) next();

  }());
};


module.exports = History2;

},{"./parse-url":7}],4:[function(require,module,exports){
var addListener = require('./add-listener');

function isLink(el) {
  return el.nodeName && el.nodeName.toLowerCase() == 'a' && el.href;
}

function getLinkAncestor(el) {
  if (isLink(el)) return el;
  while (el.parentNode && el.parentNode.nodeType == 1) {
    if (isLink(el)) return el;
    el = el.parentNode;
  }
}

module.exports = function(fn) {
  addListener(document, 'click', function(event) {
    var e = event || window.event;
    var target = e.target || e.srcElement;
    var link = getLinkAncestor(target);
    if (link) {
      fn.call(link, e);
    }
  });
};

},{"./add-listener":1}],5:[function(require,module,exports){
var supports = require('./supports');
var outboundLinks = require('./outbound-links');
var socialInteractions = require('./social-interactions');
var contentLoader = require('./content-loader');


// Add an `is-legacy` class on browsers that don't supports flexbox.
if (!supports.flexbox()) {
  document.documentElement.className += ' is-legacy';
}


// Track when the user clicks a link to an external site.
outboundLinks.track();


// Track when the user clicks a social link.
socialInteractions.track();


// Load links via AJAX instead of full page loads in browsers with pushState.
contentLoader.init();

},{"./content-loader":2,"./outbound-links":6,"./social-interactions":8,"./supports":9}],6:[function(require,module,exports){
/* global ga */

var parseUrl = require('./parse-url');
var linkClicked = require('./link-clicked');

function isExternalLink(link) {
  var url = parseUrl(link.href);
  var loc = parseUrl(location.href);
  return url.origin != loc.origin;
}

module.exports = {
  track: function() {
    linkClicked(function() {
      if (isExternalLink(this)) {

        // Opening links in an external tabs allows the ga beacon to send.
        // When following links directly, sometimes they don't make it.
        this.target = '_blank';

        ga('send', 'event', 'Outbound Link', 'click', this.href);
      }
    });

  }
};


},{"./link-clicked":4,"./parse-url":7}],7:[function(require,module,exports){
var a = document.createElement('a');
var cache = {};

/**
 * Parse the given url and return the properties returned
 * by the `Location` object.
 * @param {string} url - The url to parse.
 * @return {Object} An object with the same keys as `window.location`.
 */
module.exports = function(url) {

  if (cache[url]) return cache[url];

  var httpPort = /:80$/;
  var httpsPort = /:443/;

  a.href = url;

  // Sometimes IE will return no port or just a colon, especially for things
  // like relative port URLs (e.g. "//google.com").
  var protocol = !a.protocol || ':' == a.protocol ?
      location.protocol : a.protocol;

  // Don't include default ports.
  var port = (a.port == '80' || a.port == '443') ? '' : a.port;

  // Sometimes IE incorrectly includes a port (e.g. `:80` or `:443`)  even
  // when no port is specified in the URL.
  // http://bit.ly/1rQNoMg
  var host = a.host.replace(protocol == 'http:' ? httpPort : httpsPort, '');

  // Not all browser support `origin` so we have to build it.
  var origin = a.origin ? a.origin : protocol + '//' + host;

  // Sometimes IE doesn't include the leading slash for pathname.
  // http://bit.ly/1rQNoMg
  var pathname = a.pathname.charAt(0) == '/' ? a.pathname : '/' + a.pathname;

  return cache[url] = {
    hash: a.hash,
    host: host,
    hostname: a.hostname,
    href: a.href,
    origin: origin,
    path: pathname + a.search,
    pathname: pathname,
    port: port,
    protocol: protocol,
    search: a.search
  };
};

},{}],8:[function(require,module,exports){
/* global ga */

var linkClicked = require('./link-clicked');

module.exports = {
  track: function() {
    linkClicked(function() {
      var socialNetwork = this.getAttribute('data-social-network');
      if (socialNetwork) {
        var socialAction = this.getAttribute('data-social-action');
        var socialTarget = location.href;

        // Opening links in an external tabs allows the ga beacon to send.
        // When following links directly, sometimes they don't make it.
        this.target = '_blank';

        ga('send', 'social', socialNetwork, socialAction, socialTarget);
      }
    });
  }
};

},{"./link-clicked":4}],9:[function(require,module,exports){
var supports = {};
var style = document.body.style;

module.exports = {
  flexbox: function() {
    return supports.flexbox || (supports.flexbox = ('flexBasis' in style ||
        'msFlexAlign' in style || 'webkitBoxDirection' in style));
  }
};

},{}]},{},[5]);

}(window, document, location));
</script>

<!-- Load GA after the `window.ga` is initialized or you'll get errors. -->


  <script async src="//www.google-analytics.com/analytics_debug.js"></script>



  </body>
</html>
